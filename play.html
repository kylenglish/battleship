<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>Sea Battle Player</title><script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script><link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600&family=Lobster&family=Marck+Script&family=Montserrat:wght@400;700&family=Noto+Sans:wght@400;700&family=Open+Sans:wght@400;700&family=PT+Sans:wght@400;700&family=Rubik:wght@400;700&display=swap" rel="stylesheet">
<style>:root{--a:#00d4ff;--t:#fff;--b:0px;--h:#3e8e5e;--m:#a34646;--e:#ff4d4d;--cs:50px;--bfs:16px}body{margin:0;padding:0;background:#0a192f;color:var(--t);font-family:var(--font-family,'Segoe UI',sans-serif);height:100vh;width:100vw;overflow:hidden;background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center}.bg-overlay{position:fixed;top:0;left:0;right:0;bottom:0;backdrop-filter:blur(var(--b));-webkit-backdrop-filter:blur(var(--b));z-index:-1}body.all-neon,.neon-text{text-shadow:var(--neon-text-intensity)}#app-container{width:100%;height:100%;display:flex;flex-direction:column;justify-content:flex-start;align-items:center;box-sizing:border-box;padding:10px}.info-panel{width:100%;flex-shrink:0;display:flex;flex-direction:column;justify-content:center;align-items:center;padding-bottom:15px;z-index:10}.game-panel{width:100%;flex-grow:1;display:flex;justify-content:center;align-items:center;overflow:hidden}#startScreen{background:rgba(10,25,47,.85);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border:3px solid var(--a);border-radius:20px;padding:30px;text-align:center;width:80%;max-width:700px;max-height:90vh;overflow-y:auto;position:absolute;z-index:100;box-shadow:var(--neon-border-intensity);display:flex;flex-direction:column;align-items:center;justify-content:center}#titleDisp{color:var(--a);font-size:calc(var(--bfs)*3);margin:0 0 15px 0;line-height:1.1}.rules-list{text-align:left;margin:15px 0 25px 0;font-size:calc(var(--bfs)*1.3);line-height:1.5;width:100%}.rules-list div::before{content:"\2666\FE0E ";color:var(--a)!important;margin-right:5px}#turnInfo{color:var(--a);margin-bottom:10px;font-weight:700;font-size:calc(var(--bfs)*2);text-align:center;line-height:1.2}#statBar{font-weight:700;font-size:calc(var(--bfs)*1.5);text-align:center;display:flex;flex-direction:row;flex-wrap:wrap;align-items:center;justify-content:center;gap:15px}.stat-line{display:flex;align-items:center;justify-content:center}.stat-icon{height:1.2em;width:auto;margin-right:8px;vertical-align:middle}.grid-container{display:grid;gap:4px;padding:10px;background:rgba(0,0,0,.3);border:2px solid var(--a);border-radius:15px;box-shadow:var(--neon-border-intensity);justify-content:center;max-width:100%;box-sizing:border-box}.cell{width:100%;height:100%;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.2);border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;transition:.2s;font-size:clamp(12px,calc(var(--cs)*.3),24px);text-align:center;overflow:hidden;white-space:normal;word-break:normal;overflow-wrap:break-word;hyphens:auto;line-height:1.1;padding:2px;box-sizing:border-box}.cell:hover{background:var(--a)!important;color:#000!important;box-shadow:0 0 15px var(--a);transform:scale(1.05);z-index:2;border-color:var(--a)}.cell img{width:100%;height:100%;object-fit:contain;display:block}.cell.hit-green{background:var(--h)!important;border-color:#fff}.cell.miss-red{background:var(--m)!important;border-color:#fff}.header-cell{border:none;background:0 0;font-weight:700;color:var(--t);cursor:default;font-size:clamp(12px,calc(var(--cs)*.28),24px);display:flex;align-items:center;justify-content:center;text-align:center;white-space:normal;word-break:normal;overflow-wrap:break-word;hyphens:auto;line-height:1.1;padding:1px;box-sizing:border-box}.header-cell img{width:100%;height:100%;border-radius:4px;object-fit:contain}.highlight-header{background-color:var(--a)!important;color:#000!important;border-radius:5px;box-shadow:0 0 15px var(--a);text-shadow:none}button{background:var(--a);color:#0a192f;border:none;padding:15px 40px;font-size:calc(var(--bfs)*1.3);font-weight:700;border-radius:10px;cursor:pointer;margin-top:15px;transition:.3s;text-transform:uppercase;width:auto}button:hover{filter:brightness(1.2);transform:translateY(-2px);box-shadow:0 0 15px var(--a)}.team-input{width:100%;padding:12px;margin:8px 0;background:rgba(0,0,0,.5);border:1px solid var(--a);color:#fff;border-radius:5px;box-sizing:border-box;font-size:calc(var(--bfs)*1.1);-webkit-appearance:none}#modalOverlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);backdrop-filter:none;-webkit-backdrop-filter:none;z-index:2000;align-items:center;justify-content:center}.modal-content{background:rgba(10,25,47,.85);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border:3px solid var(--a);padding:30px;border-radius:20px;text-align:center;width:85%;max-width:500px;box-shadow:0 0 30px rgba(0,0,0,.5)}#modalTask{color:var(--a);font-weight:700;font-size:calc(var(--bfs)*1.8);margin-bottom:20px;display:flex;align-items:center;justify-content:center;gap:10px;flex-wrap:wrap}#modalTask img{max-height:60px;width:auto;object-fit:contain}#userAnswer{width:100%;padding:15px;margin-bottom:20px;background:rgba(0,0,0,.5);color:#fff;border:1px solid var(--a);border-radius:8px;text-align:center;font-size:1.2rem;-webkit-appearance:none;transition:all .3s ease}input#userAnswer.shake{border:2px solid var(--e)!important;box-shadow:0 0 15px var(--e)!important;background:rgba(255,77,77,.15)!important}#winScreen{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);backdrop-filter:none;-webkit-backdrop-filter:none;align-items:center;justify-content:center;z-index:3000;box-sizing:border-box;padding:10px}#winContent{background:rgba(10,25,47,.85);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border:3px solid var(--a);padding:20px;border-radius:20px;text-align:center;box-shadow:0 0 40px var(--a);width:100%;max-width:500px;display:flex;flex-direction:column;align-items:center}#winImgContainer img{max-width:100%;max-height:30vh;height:auto;margin:15px auto;border-radius:10px;box-shadow:0 0 15px var(--a);display:block;object-fit:contain}#winText{font-size:clamp(1.2rem,5vw,2.5rem);margin:0 0 15px 0;line-height:1.4;word-break:normal}#restartBtn{flex-shrink:0}#progress-area{width:95%;max-width:900px;text-align:center;margin:10px auto 0 auto}.water-tank{width:100%;height:26px;background:rgba(255,255,255,.05);border:3px solid var(--a);border-radius:15px;overflow:hidden;margin-top:5px;position:relative;animation:pT 1.5s infinite alternate}@keyframes pT{0%{box-shadow:0 0 5px var(--a),inset 0 0 5px var(--a)}100%{box-shadow:0 0 20px var(--a),inset 0 0 15px var(--a)}}#water-fill{width:0%;height:100%;background:linear-gradient(90deg,var(--a),#fff,var(--a));background-size:200% 100%;animation:mG 3s infinite linear;transition:width .6s ease;opacity:.9}@keyframes mG{0%{background-position:0 0}100%{background-position:100% 0}}.shake{animation:sh .4s cubic-bezier(.36,.07,.19,.97) both}@keyframes sh{10%,90%{transform:translate3d(-1px,0,0)}20%,80%{transform:translate3d(2px,0,0)}30%,50%,70%{transform:translate3d(-4px,0,0)}40%,60%{transform:translate3d(4px,0,0)}}#combo-meter{position:fixed;top:10px;right:10px;background:rgba(0,0,0,.85);padding:5px 15px;border-radius:50px;border:2px solid #f1c40f;color:#f1c40f;font-weight:700;display:none;z-index:100;font-size:1rem;box-shadow:0 0 10px #f1c40f}.combo-active{display:block!important;animation:pl .8s infinite alternate}@keyframes pl{from{transform:scale(1)}to{transform:scale(1.15)}}</style></head><body>
<script>const audioCtx=new(window.AudioContext||window.webkitAudioContext)();function playSound(e,t,n,o=.1){if("suspended"===audioCtx.state)audioCtx.resume();const a=audioCtx.currentTime;e.forEach((e,c)=>{const r=audioCtx.createOscillator(),i=audioCtx.createGain();r.type=t;r.frequency.setValueAtTime(e,a+8e-3*c);r.connect(i);i.connect(audioCtx.destination);i.gain.setValueAtTime(o,a+8e-3*c);i.gain.exponentialRampToValueAtTime(.01,a+8e-3*c+n);r.start(a+8e-3*c);r.stop(a+8e-3*c+n)})}function playSadSound(){playSound([300,250,200,150],"sawtooth",.6,.2)}</script>
<div class="bg-overlay"></div><div id="combo-meter">üî• COMBO X<span id="combo-count">0</span></div>
<div id="modalOverlay"><div class="modal-content" id="modalBox"><h3 id="modalTitle" style="margin-top:0;color:#fff;"></h3><div id="modalTask"></div><input type="text" id="userAnswer" placeholder="..." autocomplete="off"><button onclick="checkModalAnswer()" id="shotBtn"></button></div></div>
<div id="startScreen"><h1 id="titleDisp" class="neon-text"></h1><div class="rules-list" id="rulesBlock"></div><div id="teamSetup" style="display:none;margin-top:10px;width:100%;"></div><button id="startBtn" onclick="handleStartClick()"></button></div>
<div id="winScreen"><div id="winContent"><h2 id="winText" class="neon-text"></h2><div id="winImgContainer"></div><button onclick="location.reload()" id="restartBtn"></button></div></div>
<div id="app-container" style="visibility:hidden;"><div class="info-panel"><div id="turnInfo"></div><div id="statBar"></div><div id="progress-area"><div class="water-tank"><div id="water-fill"></div></div></div></div><div class="game-panel"><div id="grid" class="grid-container"></div></div></div>
<script>const urlParams=new URLSearchParams(window.location.search);let cfg={t:"–ú–û–†–°–ö–û–ô –ë–û–ô",x:[],y:[],c:"#00d4ff",s:3,fColor:"#ffffff",bg:"",blur:0,winT:"–ü–æ–±–µ–¥–∞!",winI:"",mode:"classic",answers:"",challengeLimit:30,challengeType:"time",gameType:"solo",teamCount:2,lang:"ru",font:"PT Sans",neonText:!0,neonBorder:!0,rules:"–ù–∞–∂–∏–º–∞–π –Ω–∞ –∫–ª–µ—Ç–∫–∏...",bgColor:"#0a192f",resetBg:!1};if(urlParams.has("data"))try{let e=urlParams.get("data").replace(/ /g,"+");let t=JSON.parse(decodeURIComponent(escape(atob(e))));cfg={...cfg,...t}}catch(e){console.error("Error",e)}const tr={ru:{f:"–ù–∞–π–¥–µ–Ω–æ",y:"–í—ã",r:"–†–æ–±–æ—Ç",t:"–•–û–î",yT:"–í–ê–® –•–û–î",rT:"–•–û–î –†–û–ë–û–¢–ê...",tU:"–í–†–ï–ú–Ø –í–´–®–õ–û!",nM:"–•–û–î–´ –ó–ê–ö–û–ù–ß–ò–õ–ò–°–¨",gO:"–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê",p:"–ò–ì–†–ê–¢–¨",pA:"–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê",fi:"–í–´–°–¢–†–ï–õ–ò–¢–¨!",mS:"–°–æ—Å—Ç–∞–≤—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ",wH:"–ù–∞–ø–∏—à–∏—Ç–µ –∑–¥–µ—Å—å...",tm:"–ö–æ–º–∞–Ω–¥–∞",w:"–ü–æ–±–µ–¥–∏—Ç–µ–ª—å",s:"–°—á–µ—Ç"},en:{f:"Found",y:"You",r:"Robot",t:"TURN",yT:"YOUR TURN",rT:"ROBOT'S TURN...",tU:"TIME'S UP!",nM:"OUT OF MOVES",gO:"GAME OVER",p:"PLAY",pA:"PLAY AGAIN",fi:"FIRE!",mS:"Make a sentence",wH:"Write here...",tm:"Team",w:"Winner",s:"Score"},math:{f:"–ù–∞–π–¥–µ–Ω–æ",y:"–í—ã",r:"–†–æ–±–æ—Ç",t:"–•–û–î",yT:"–í–ê–® –•–û–î",rT:"–•–û–î –†–û–ë–û–¢–ê...",tU:"–í–†–ï–ú–Ø –í–´–®–õ–û!",nM:"–•–û–î–´ –ó–ê–ö–û–ù–ß–ò–õ–ò–°–¨",gO:"–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê",p:"–ò–ì–†–ê–¢–¨",pA:"–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê",fi:"–†–ï–®–ò–¢–¨!",mS:"–í—ã—á–∏—Å–ª–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ",wH:"–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç...",tm:"–ö–æ–º–∞–Ω–¥–∞",w:"–ü–æ–±–µ–¥–∏—Ç–µ–ª—å",s:"–°—á–µ—Ç"}};const txt=tr[cfg.lang]||tr.ru;document.getElementById("startBtn").innerText=txt.p;document.getElementById("restartBtn").innerText=txt.pA;document.getElementById("shotBtn").innerText=txt.fi;document.getElementById("modalTitle").innerText=txt.mS;document.getElementById("userAnswer").placeholder=txt.wH;document.getElementById("titleDisp").innerText=cfg.t;document.getElementById("rulesBlock").innerHTML=cfg.rules.split("\n").map(e=>`<div>${e}</div>`).join("");const root=document.documentElement;root.style.setProperty("--accent",cfg.c);root.style.setProperty("--text-color",cfg.fColor);root.style.setProperty("--blur",(cfg.blur||0)+"px");if(cfg.font)root.style.setProperty("--font-family",`'${cfg.font}', sans-serif`);if(cfg.transparentBg){document.documentElement.style.background="transparent";document.body.style.background="transparent";document.body.style.backgroundImage="none";const e=document.createElement("style");e.innerHTML=`html,body,:root{background:transparent!important;background-color:transparent!important}.bg-overlay{display:none!important}#startScreen,#winContent,.modal-content{background:rgba(10,25,47,.4)!important;backdrop-filter:blur(15px) saturate(150%)!important;-webkit-backdrop-filter:blur(15px) saturate(150%)!important;border:2px solid rgba(255,255,255,.2)!important;box-shadow:0 8px 32px 0 rgba(0,0,0,.3)!important}.team-input,#combo-meter,#userAnswer{background:rgba(255,255,255,.1)!important;backdrop-filter:blur(10px)!important;-webkit-backdrop-filter:blur(10px)!important;border:1px solid rgba(255,255,255,.3)!important;color:#fff!important}input#userAnswer.shake{border:2px solid var(--e)!important;box-shadow:0 0 15px var(--e)!important;background:rgba(255,77,77,.15)!important}#winScreen,#modalOverlay{background:rgba(0,0,0,.5)!important;backdrop-filter:none!important;-webkit-backdrop-filter:none!important}#winText,#modalTitle,#modalTask,.rules-list div,#userAnswer{color:#fff!important;text-shadow:0 0 10px rgba(0,0,0,.5)!important}.grid-container{background:rgba(0,0,0,.2)!important;backdrop-filter:blur(5px)!important;-webkit-backdrop-filter:blur(5px)!important;border:2px solid var(--accent)!important}`;document.head.appendChild(e)}else if(cfg.resetBg){document.body.style.background="#0a192f";document.body.style.backgroundImage="none"}else{if(cfg.bgColor&&cfg.bgColor!=="#0a192f")document.body.style.background=cfg.bgColor;if(cfg.bg){if(cfg.bg.startsWith("http"))document.body.style.backgroundImage=`url('${cfg.bg}')`;else document.body.style.background=cfg.bg}}root.style.setProperty("--neon-text-intensity",!1!==cfg.neonText&&"false"!==cfg.neonText?`0 0 10px ${cfg.fColor}`:"none");root.style.setProperty("--neon-border-intensity",!1!==cfg.neonBorder&&"false"!==cfg.neonBorder?`0 0 20px ${cfg.c}66`:"none");if(!1!==cfg.neonText&&"false"!==cfg.neonText)document.body.classList.add("all-neon");let found=0,pcFound=0,gameOver=!1,timerInterval;let isPlayerTurn=!0,currentTeamIdx=0,teams=[];let timeLeft=parseInt(cfg.challengeLimit)||30;let movesLeft=parseInt(cfg.challengeLimit)||30;let hitCombo=0;const targets=new Set,openedCells=new Set;const ansMap=cfg.answers?cfg.answers.split("\n").map(e=>e.trim().toLowerCase()):[];let currentAttemptIdx=null,currentAttemptCell=null,cellElements={};let lastGridW=0,lastGridH=0;function resizeGame(){const e=document.getElementById("app-container");const t=document.querySelector(".info-panel");const n=document.querySelector(".game-panel");const o=document.getElementById("grid");const a=e.clientHeight;const c=t.offsetHeight;const r=a-c-20;const i=n.clientWidth;const l=cfg.x.length+1;const s=cfg.y.length+1;const d=Math.floor((i-24-(l-1)*4)/l);const m=Math.floor((r-24-(s-1)*4)/s);let u=Math.min(d,m);u=Math.max(15,Math.min(u,110));root.style.setProperty("--cell-size",u+"px");if(o){o.style.gridTemplateColumns=`repeat(${l}, minmax(0, var(--cell-size)))`;o.style.gridTemplateRows=`repeat(${s}, minmax(0, var(--cell-size)))`}const g=Math.min(window.innerWidth,window.innerHeight);root.style.setProperty("--base-font-size",Math.max(16,g/35)+"px");if(o&&document.getElementById("progress-area")){document.getElementById("progress-area").style.width=o.offsetWidth+"px";document.getElementById("progress-area").style.maxWidth="none"}const f=o?o.offsetWidth:0;const p=o?o.offsetHeight:0;if(lastGridW!==f||lastGridH!==p){lastGridW=f;lastGridH=p;setTimeout(()=>{document.querySelectorAll(".cell").forEach(e=>{if(e.querySelector("img"))return;e.style.fontSize="";let t=parseFloat(window.getComputedStyle(e).fontSize);while((e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth)&&t>12){t-=.5;e.style.fontSize=t+"px"}})},50)}}window.addEventListener("resize",resizeGame);setInterval(resizeGame,1e3);function renderHeaderContent(e){if(e.toLowerCase().startsWith("http"))return`<img src="${e.trim()}">`;if("math"===cfg.lang){try{return katex.renderToString(e,{throwOnError:!1,displayMode:!1})}catch(t){return e}}return e}function handleStartClick(){playSound([440,554,659,880],"sine",.6);if("team"===cfg.gameType&&0===teams.length){document.getElementById("rulesBlock").style.display="none";document.getElementById("startBtn").style.display="none";showTeamSetup()}else{startGame()}}function showTeamSetup(){const e=document.getElementById("teamSetup");e.style.display="block";e.innerHTML=`<h3 style="color:var(--accent); margin:0 0 10px 0;">${txt.tm}:</h3>`;for(let t=1;t<=cfg.teamCount;t++){e.innerHTML+=`<input type="text" id="teamName${t}" class="team-input" placeholder="${txt.tm} ${t}">`}const t=document.createElement("button");t.innerText="OK";t.id="startBtn";t.onclick=()=>{playSound([440,554,659,880],"sine",.6);for(let e=1;e<=cfg.teamCount;e++){let t=document.getElementById(`teamName${e}`).value||`${txt.tm} ${e}`;teams.push({name:t,score:0})}startGame()};e.appendChild(t)}function startGame(){document.getElementById("startScreen").style.display="none";document.getElementById("app-container").style.visibility="visible";initGrid();setTimeout(resizeGame,50);if("challenge"===cfg.mode&&"time"===cfg.challengeType){timerInterval=setInterval(()=>{timeLeft--;updateStats();if(timeLeft<=0){playSadSound();endGame(!1,txt.tU)}},1e3)}updateStats()}function updateStats(){let e="";let t=cfg.targetImg?`<img src="${cfg.targetImg}" class="stat-icon">`:"üö¢";let n="team"===cfg.gameType?teams.reduce((e,t)=>e+t.score,0):found+pcFound;if("team"===cfg.gameType){let o=teams.map(e=>`${e.name}: ${e.score}`).join(" | ");let a=`<div class="stat-line">${t} ${txt.f}: ${n} / ${cfg.s}</div>`;e=`<div>${o}</div>${a}`;if(teams.length>0)document.getElementById("turnInfo").innerText=`${txt.t}: ${teams[currentTeamIdx].name}`}else{if("computer"===cfg.mode){e=`<div class="stat-line">${t} ${txt.y}: ${found} | ${txt.r}: ${pcFound} / ${cfg.s}</div>`}else{e=`<div class="stat-line">${t} ${txt.f}: ${found} / ${cfg.s}</div>`}document.getElementById("turnInfo").innerText=isPlayerTurn?txt.yT:txt.rT}if("challenge"===cfg.mode){e+="time"===cfg.challengeType?` <div class="stat-line">| ‚è± ${timeLeft}s</div>`:` <div class="stat-line">| üéØ ${movesLeft}</div>`}document.getElementById("statBar").innerHTML=e;let o=n/cfg.s*100;let a=document.getElementById("water-fill");if(a)a.style.width=Math.min(o,100)+"%"}function highlightHeaders(e,t,n){const o=document.getElementById(`header-x-${t}`);const a=document.getElementById(`header-y-${e}`);if(o)n?o.classList.add("highlight-header"):o.classList.remove("highlight-header");if(a)n?a.classList.add("highlight-header"):a.classList.remove("highlight-header")}function initGrid(){const e=document.getElementById("grid");e.innerHTML="";e.style.gridTemplateColumns=`repeat(${cfg.x.length+1}, minmax(0, var(--cell-size)))`;const t=cfg.x.length*cfg.y.length;targets.clear();while(targets.size<Math.min(cfg.s,t))targets.add(Math.floor(Math.random()*t));for(let n=0;n<=cfg.y.length;n++){for(let o=0;o<=cfg.x.length;o++){const a=document.createElement("div");a.className="cell";if(0===n||0===o){a.className+=" header-cell";if(0===n&&0===o){}else if(0===n){a.innerHTML=renderHeaderContent(cfg.x[o-1]);a.id=`header-x-${o}`}else if(0===o){a.innerHTML=renderHeaderContent(cfg.y[n-1]);a.id=`header-y-${n}`}}else{const c=(n-1)*cfg.x.length+(o-1);cellElements[c]=a;a.onmouseenter=()=>highlightHeaders(n,o,!0);a.onmouseleave=()=>highlightHeaders(n,o,!1);a.onclick=()=>handleMove(c,a,cfg.x[o-1],cfg.y[n-1])}e.appendChild(a)}}}function handleMove(e,t,n,o){if(gameOver||openedCells.has(e)||!isPlayerTurn&&"computer"===cfg.mode)return;if("writing"===cfg.mode){currentAttemptIdx=e;currentAttemptCell=t;document.getElementById("modalOverlay").style.display="flex";let a;if("math"===cfg.lang){a=`${renderHeaderContent(n)} &nbsp;&nbsp;&nbsp; ${renderHeaderContent(o)}`}else{a=`${renderHeaderContent(n)} + ${renderHeaderContent(o)}`}document.getElementById("modalTask").innerHTML=a;document.getElementById("userAnswer").value="";document.getElementById("userAnswer").focus()}else{const a=processCell(e,t);if(!a&&!gameOver)finalizeTurn()}}function checkModalAnswer(){let e=document.getElementById("userAnswer").value.trim().toLowerCase();let t=(ansMap[currentAttemptIdx]||"").toLowerCase();const n=document.getElementById("userAnswer");let o=!1;if("math"===cfg.lang){let a=e.replace(",",".");let c=t.replace(",",".");o=parseFloat(a)===parseFloat(c)&&!isNaN(parseFloat(a))}else{o=e&&e===t}if(o){document.getElementById("modalOverlay").style.display="none";n.classList.remove("shake");const a=processCell(currentAttemptIdx,currentAttemptCell);if(!a&&!gameOver)finalizeTurn()}else{playSound([150,100],"sawtooth",.4,.08);n.classList.remove("shake");void n.offsetWidth;n.classList.add("shake")}}function updateComboUI(){const e=document.getElementById("combo-meter");const t=document.getElementById("combo-count");t.innerText=hitCombo;if(hitCombo>=2){e.classList.add("combo-active");playSound([600,800,1000],"sine",.3)}else{e.classList.remove("combo-active")}}function processCell(e,t){if(openedCells.has(e))return!1;if("challenge"===cfg.mode&&"moves"===cfg.challengeType)movesLeft--;openedCells.add(e);let n=!1;if(targets.has(e)){hitCombo++;playSound([600,800,1000],"sine",.3);t.innerHTML=cfg.targetImg?`<img src="${cfg.targetImg}">`:"üö¢";t.classList.add("hit-green");if("team"===cfg.gameType)teams[currentTeamIdx].score++;else if(isPlayerTurn)found++;else pcFound++;updateStats();updateComboUI();n=!0}else{hitCombo=0;updateComboUI();playSound([120,80],"sawtooth",.4,.15);t.innerHTML="";t.classList.add("miss-red");n=!1}const o="team"===cfg.gameType?teams.reduce((e,t)=>e+t.score,0):found+pcFound;if(o>=cfg.s){setTimeout(()=>checkWinner(),500)}else if("challenge"===cfg.mode&&"moves"===cfg.challengeType&&movesLeft<=0){playSadSound();endGame(!1,txt.nM)}return n}function finalizeTurn(){if(gameOver)return;if("team"===cfg.gameType){currentTeamIdx=(currentTeamIdx+1)%teams.length;updateStats()}else if("computer"===cfg.mode){isPlayerTurn=!1;updateStats();setTimeout(computerTurn,1e3)}}function computerTurn(){if(gameOver)return;let e=[];for(let t=0;t<cfg.x.length*cfg.y.length;t++)if(!openedCells.has(t))e.push(t);if(0===e.length)return;let t=e[Math.floor(Math.random()*e.length)];const n=processCell(t,cellElements[t]);if(n&&!gameOver)setTimeout(computerTurn,1e3);else{isPlayerTurn=!0;updateStats()}}function checkWinner(){let e=cfg.winT||"–ü–æ–±–µ–¥–∞!";if("team"===cfg.gameType){let t=teams.reduce((e,t)=>e.score>t.score?e:t);let n=teams.map(e=>e.score).join(" : ");let o=t.name.replace(/ /g,"&nbsp;");endGame(!0,`<div style="margin-bottom: 15px;">${e}</div><div style="margin-bottom: 10px;">${txt.w} - ${o}</div><div>${txt.s}: ${n}</div>`)}else if("computer"===cfg.mode){let t=found>=pcFound?txt.y:txt.r;let n=t.replace(/ /g,"&nbsp;");endGame(found>=pcFound,`<div style="margin-bottom: 15px;">${e}</div><div style="margin-bottom: 10px;">${txt.w} - ${n}</div><div>${txt.s}: ${found} : ${pcFound}</div>`)}else{endGame(found>=pcFound)}}function endGame(e,t){gameOver=!0;if(timerInterval)clearInterval(timerInterval);const n=document.getElementById("winText");const o=document.getElementById("winImgContainer");if(e){n.innerHTML="string"==typeof t&&t.length>5?t:cfg.winT||"–ü–æ–±–µ–¥–∞!";if(cfg.winI)o.innerHTML=`<img src="${cfg.winI}">`;confetti({particleCount:250,spread:100,origin:{y:.6},colors:["#00d4ff","#fff","#27ae60"],zIndex:12e3});playSound([400,500,600,800,1000,1200],"triangle",1)}else{n.innerHTML=t||txt.gO;o.innerHTML=""}document.getElementById("winScreen").style.display="flex"}document.getElementById("userAnswer").addEventListener("keypress",e=>{"Enter"===e.key&&checkModalAnswer()});let forceView=urlParams.get("view")||"start";if("team"===forceView&&"team"!==cfg.gameType)forceView="start";if("board"===forceView){document.getElementById("startScreen").style.display="none";document.getElementById("app-container").style.visibility="visible";if("team"===cfg.gameType&&0===teams.length){for(let e=1;e<=cfg.teamCount;e++)teams.push({name:txt.tm+" "+e,score:0})}initGrid();setTimeout(resizeGame,50);updateStats()}else if("team"===forceView){document.getElementById("rulesBlock").style.display="none";document.getElementById("startBtn").style.display="none";showTeamSetup()}</script>
</body></html>
